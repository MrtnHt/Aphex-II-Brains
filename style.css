/* Base Reset */
* { box-sizing: border-box; overflow-wrap: anywhere; word-break: break-word; }
html, body { height: 100%; margin: 0; padding: 0; }
body { display: flex; flex-direction: column; }

:root {
  --bg: #0b1020;
  --card: rgba(255,255,255,0.05);
  --text: #e9eef9;
  --muted: #a6b0c2;
  --primary: #2d7cff;
  --primary-600: #1f63d6;
  --danger: #e5484d;
  --danger-600: #c03237;
  --border: rgba(255,255,255,0.2);
  --success: #12d67a;
}

/* Topbar */
.topbar { position: sticky; top: 0; z-index: 5; display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; backdrop-filter: blur(8px); border-bottom: 1px solid var(--border); }
.topbar .left .brand { display: flex; align-items: center; gap: 8px; color: var(--text); font-weight: 600; }
.topbar .left .brand .title { opacity: 0.9; }
.topbar .left .brand .sep { opacity: 0.5; }
.topbar .right { display: flex; align-items: center; gap: 8px; }
.topbar .icon { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 6px 9px; border-radius: 8px; cursor: pointer; }
.topbar .icon:hover { background: var(--card); }
#costLabel { color: var(--muted); font-size: 12px; margin-right: 6px; }

.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; background: var(--success); box-shadow: 0 0 6px var(--success); }

/* Layout */
.container { flex: 1; display: flex; padding: 10px; }
.chat { width: 100%; max-width: 980px; margin: 0 auto; display: flex; flex-direction: column; gap: 10px; padding-bottom: 80px; }
.message { border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; background: var(--card); color: var(--text); }
.message.user { border-color: rgba(45,124,255,0.35); }
.message.assistant { border-color: rgba(18,214,122,0.35); }
.message.system { border-color: rgba(255,255,255,0.25); opacity: 0.9; }
.message.context { border-style: dashed; opacity: 0.95; }
.message header { font-size: 12px; color: var(--muted); margin-bottom: 6px; display: flex; gap: 8px; align-items: center; }
.message pre, .message code { white-space: pre-wrap; }
pre { background: rgba(0,0,0,0.3); border: 1px dashed var(--border); padding: 8px; border-radius: 8px; overflow-x: auto; }

/* Input Bar */
.inputbar { position: sticky; bottom: 0; z-index: 5; background: rgba(0,0,0,0.15); border-top: 1px solid var(--border); padding: 8px 10px; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(8px); }
.controls { display: flex; align-items: center; gap: 8px; }
.switch { position: relative; display: inline-block; width: 46px; height: 24px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #6b7280; transition: .2s; border-radius: 24px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; transition: .2s; border-radius: 50%; }
.switch input:checked + .slider { background: var(--primary); }
.switch input:checked + .slider:before { transform: translateX(22px); }
.switch-label { color: var(--text); font-size: 14px; }

.composer { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: end; }
#promptInput { width: 100%; border-radius: 12px; border: 1px solid var(--border); padding: 10px 12px; background: var(--card); color: var(--text); font-size: 16px; resize: none; max-height: 40vh; }
.actions { display: flex; gap: 8px; }

.btn { border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: var(--text); padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600; }
.btn:hover { filter: brightness(1.05); }
.btn.primary { background: var(--primary); border-color: var(--primary-600); }
.btn.primary:hover { background: var(--primary-600); }
.btn.danger { background: var(--danger); border-color: var(--danger-600); }
.btn.danger:hover { background: var(--danger-600); }

/* Modal */
dialog { width: min(720px, 92vw); border: 1px solid var(--border); border-radius: 14px; padding: 16px; background: var(--bg); color: var(--text); }
dialog::backdrop { background: rgba(0,0,0,0.4); backdrop-filter: blur(2px); }
fieldset { border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 12px; }
legend { color: var(--muted); font-size: 13px; padding: 0 6px; }
label { display: grid; gap: 6px; margin: 8px 0; color: var(--text); font-size: 14px; }
input[type="text"], input[type="password"], select, textarea { width: 100%; border-radius: 10px; border: 1px solid var(--border); padding: 10px 12px; background: var(--card); color: var(--text); font-size: 16px; }
.modal-actions { display: flex; gap: 8px; justify-content: flex-end; }

/* Themes */
/* Theme Glass */
.theme-glass { --bg: #0b1020; --card: rgba(255,255,255,0.06); --text: #e9eef9; --muted: #a6b0c2; --border: rgba(255,255,255,0.18);} 
.theme-glass body, .theme-glass { background: radial-gradient(1200px 500px at 30% -10%, rgba(45,124,255,0.20), transparent), radial-gradient(1000px 600px at 80% 10%, rgba(18,214,122,0.12), transparent), var(--bg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji; }
.theme-glass .message { backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.16); }
.theme-glass .topbar { background: rgba(15,20,40,0.5); }

/* Theme Matrix */
.theme-matrix { --bg: #000; --card: rgba(0, 30, 0, 0.45); --text: #bfffbf; --muted: #72c772; --border: rgba(0,255,110,0.25); }
.theme-matrix body, .theme-matrix { background: #000; color: var(--text); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace; position: relative; }
.theme-matrix::before { content: ""; position: fixed; inset: 0; pointer-events: none; background: repeating-linear-gradient(0deg, rgba(0,255,110,0.055), rgba(0,255,110,0.055) 1px, transparent 1px, transparent 3px); mix-blend-mode: overlay; opacity: 0.35; }
.theme-matrix .message { background: rgba(0, 20, 0, 0.55); text-shadow: 0 0 2px rgba(0,255,110,0.3); }
.theme-matrix .topbar { background: rgba(0, 20, 0, 0.7); }

/* Mobile Tweaks */
@media (max-width: 640px) {
  .topbar .left .brand .title { display: none; }
  .composer { grid-template-columns: 1fr; }
  .actions { justify-content: space-between; }
}

/* iOS Zoom Fix */
input, textarea, select, button { font-size: 16px; }

/* Code block horizontal scroll */
code, pre { overflow-x: auto; }
